<html>
	<head>
		<title>Sphere Drawing</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="lib/three.min.js"></script>
		<script src="lib/TrackballControls.js"></script>
		<script src="lib/stats.min.js"></script>
		<script src="lib/FileSaver.min.js"></script>
		<script src="lib/STLFileSaver.js"></script>
		<script src="js/render.js"></script> <!-- moved evironment initialization -->
		<script>
			//initial values
			var posX = 0;
			var posY = 0;
			var posZ = 0;
			var strokeSize = 0.1;
			var TOTAL_NUM_SPHERES = 100;
			
			//our test function
			function addRandomSphere() {
				addSphere(posX, posY, posZ, strokeSize); //this is how we do it!
				//randomly generate next sphere's parameters
				posX+=(Math.random()-0.5)*0.3;
				posY+=(Math.random()-0.5)*0.3;
				posZ+=(Math.random()-0.5)*0.3;
				var strokeVariation = (Math.random()-0.5)*0.1;
				if (strokeSize + strokeVariation > 0) {
					strokeSize+=strokeVariation;
				}
				numberOfSpheres++;
			}
			
			while (numberOfSpheres < TOTAL_NUM_SPHERES) {
				addRandomSphere();
			}
			
			function movePointer() {
				//CALL THESE FUNCTIONS
				changeSphereSize(strokeSize);
				movePointerSphere(posX,posY,posZ);
				
				//and this is how we update these values to be interesting
				posX+=(Math.random()-0.5)*0.3;
				posY+=(Math.random()-0.5)*0.3;
				posZ+=(Math.random()-0.5)*0.3;
				var strokeVariation = (Math.random()-0.5)*0.05;
				if (strokeSize + strokeVariation > 0) {
					strokeSize+=strokeVariation;
				}
			}
			//setInterval(movePointer, 50); //moving our pointer around at 20 frames per second
			
			
			//try exporting file
			var saveSTLinProgress = false;
			function saveStl() {
				var stlString = "solid\n";
				console.log(allSpheres);
				for (i = 0; i < numberOfSpheres; i++) {
					geometry = allSpheres[i];
					console.log(geometry);
					stlString += generateSTL( geometry );
				}
				stlString += "endsolid";
				var blob = new Blob([stlString], {type: 'text/plain'});
				saveAs(blob, 'mesh.stl');
			}
			
			function onSaveKeyDown(e) {
				console.log(e.keyCode);
				// yes, we are designating key Z to be the save key here
				if (!saveSTLinProgress && String.fromCharCode(e.keyCode) === 'Z') {
					console.log("Save called");
					saveSTLinProgress = true; //lolol our primitive lock
					saveStl();
					saveSTLinProgess = false;
				}
			}
			
			document.addEventListener("keydown", onSaveKeyDown, false);
		</script>
	</body>
</html>